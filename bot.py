from keep_alive import keep_alive
keep_alive()

from telegram import Update, ReplyKeyboardMarkup, ReplyKeyboardRemove, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ConversationHandler, CallbackQueryHandler
import json
import time
import os
import re
from datetime import datetime
from pymongo import MongoClient

# --- –ù–ê–°–¢–†–û–ô–ö–ê –ë–ê–ó–´ –î–ê–ù–ù–´–• ---
MONGO_URL = os.getenv('MONGO_URL') 

if MONGO_URL:
    try:
        cluster = MongoClient(MONGO_URL)
        db = cluster["bible_bot_db"]
        collection = db["leaderboard"]
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î: {e}")
        collection = None
else:
    print("‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ù–µ –∑–∞–¥–∞–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è MONGO_URL. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è!")
    collection = None

# –°–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
CHOOSING_LEVEL, ANSWERING = range(2)

# –õ–Å–ì–ö–ò–ô –£–†–û–í–ï–ù–¨
easy_questions = [
    {
        "question": "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª –ü–µ—Ä–≤–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ –ü–µ—Ç—Ä–∞?",
        "options": ["–ê–ø–æ—Å—Ç–æ–ª –ü–∞–≤–µ–ª", "–ê–ø–æ—Å—Ç–æ–ª –ü–µ—Ç—Ä", "–ê–ø–æ—Å—Ç–æ–ª –ò–æ–∞–Ω–Ω", "–ê–ø–æ—Å—Ç–æ–ª –ò–∞–∫–æ–≤"],
        "correct": 1,
        "explanation": "–ê–≤—Ç–æ—Ä–æ–º –ø–æ—Å–ª–∞–Ω–∏—è —è–≤–ª—è–µ—Ç—Å—è –∞–ø–æ—Å—Ç–æ–ª –ü–µ—Ç—Ä, –æ–¥–∏–Ω –∏–∑ –±–ª–∏–∂–∞–π—à–∏—Ö —É—á–µ–Ω–∏–∫–æ–≤ –ò–∏—Å—É—Å–∞ –•—Ä–∏—Å—Ç–∞. –û–Ω –Ω–∞–ø–∏—Å–∞–ª —ç—Ç–æ –ø–æ—Å–ª–∞–Ω–∏–µ –æ–∫–æ–ª–æ 62-63 –≥–≥. –Ω.—ç., –Ω–∞—Ö–æ–¥—è—Å—å –≤ –†–∏–º–µ."
    },
    {
        "question": "–í –∫–∞–∫–æ–º –≥–æ–¥—É –ø—Ä–∏–º–µ—Ä–Ω–æ –±—ã–ª–æ –Ω–∞–ø–∏—Å–∞–Ω–æ –ø–æ—Å–ª–∞–Ω–∏–µ?",
        "options": ["30-33 –≥–≥.", "50-55 –≥–≥.", "62-63 –≥–≥.", "70-75 –≥–≥."],
        "correct": 2,
        "explanation": "–ü–æ—Å–ª–∞–Ω–∏–µ –±—ã–ª–æ –Ω–∞–ø–∏—Å–∞–Ω–æ –æ–∫–æ–ª–æ 62-63 –≥–≥. –Ω.—ç., –Ω–µ–∑–∞–¥–æ–ª–≥–æ –¥–æ –Ω–∞—á–∞–ª–∞ –º–∞—Å—Å–æ–≤—ã—Ö –≥–æ–Ω–µ–Ω–∏–π –ø—Ä–∏ –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–µ –ù–µ—Ä–æ–Ω–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—á–∞–ª–∏—Å—å –≤ 64 –≥. –ø–æ—Å–ª–µ –ø–æ–∂–∞—Ä–∞ –≤ –†–∏–º–µ."
    },
    {
        "question": "–ì–¥–µ –Ω–∞—Ö–æ–¥–∏–ª—Å—è –ü–µ—Ç—Ä, –∫–æ–≥–¥–∞ –ø–∏—Å–∞–ª –ø–æ—Å–ª–∞–Ω–∏–µ?",
        "options": ["–í –ò–µ—Ä—É—Å–∞–ª–∏–º–µ", "–í –†–∏–º–µ", "–í –ê–Ω—Ç–∏–æ—Ö–∏–∏", "–í –ï—Ñ–µ—Å–µ"],
        "correct": 1,
        "explanation": "–ü–µ—Ç—Ä –Ω–∞—Ö–æ–¥–∏–ª—Å—è –≤ –†–∏–º–µ, –∫–æ–≥–¥–∞ –ø–∏—Å–∞–ª –ø–æ—Å–ª–∞–Ω–∏–µ. –í 1 –ü–µ—Ç. 5:13 –æ–Ω —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏ –Ω–∞–∑—ã–≤–∞–µ—Ç –†–∏–º '–í–∞–≤–∏–ª–æ–Ω–æ–º', –≤–æ–∑–º–æ–∂–Ω–æ, –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ö—Ä–∏—Å—Ç–∏–∞–Ω –≤–æ –≤—Ä–µ–º—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö—Å—è –≥–æ–Ω–µ–Ω–∏–π."
    },
    {
        "question": "–ö–∞–∫ –ü–µ—Ç—Ä —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏ –Ω–∞–∑–≤–∞–ª –†–∏–º –≤ –ø–æ—Å–ª–∞–Ω–∏–∏?",
        "options": ["–ï–≥–∏–ø–µ—Ç", "–í–∞–≤–∏–ª–æ–Ω", "–°–æ–¥–æ–º", "–ù–∏–Ω–µ–≤–∏—è"],
        "correct": 1,
        "explanation": "–ü–µ—Ç—Ä –Ω–∞–∑–≤–∞–ª –†–∏–º '–í–∞–≤–∏–ª–æ–Ω–æ–º' (1 –ü–µ—Ç. 5:13). –≠—Ç–æ –±—ã–ª–æ –∫–æ–¥–æ–≤–æ–µ –∏–º—è, —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É—é—â–µ–µ —Ü–µ–Ω—Ç—Ä —è–∑—ã—á–µ—Å–∫–æ–π –≤–ª–∞—Å—Ç–∏ –∏ –∏–¥–æ–ª–æ–ø–æ–∫–ª–æ–Ω—Å—Ç–≤–∞, –ø–æ–¥–æ–±–Ω–æ –¥—Ä–µ–≤–Ω–µ–º—É –í–∞–≤–∏–ª–æ–Ω—É."
    },
    {
        "question": "–ö–æ–º—É –±—ã–ª–æ –∞–¥—Ä–µ—Å–æ–≤–∞–Ω–æ –ø–æ—Å–ª–∞–Ω–∏–µ?",
        "options": ["–†–∏–º—Å–∫–∏–º —Ö—Ä–∏—Å—Ç–∏–∞–Ω–∞–º", "–ò–µ—Ä—É—Å–∞–ª–∏–º—Å–∫–æ–π —Ü–µ—Ä–∫–≤–∏", "–•—Ä–∏—Å—Ç–∏–∞–Ω–∞–º –ú–∞–ª–æ–π –ê–∑–∏–∏", "–í—Å–µ–º —è–∑—ã—á–Ω–∏–∫–∞–º"],
        "correct": 2,
        "explanation": "–ü–æ—Å–ª–∞–Ω–∏–µ –±—ã–ª–æ –∞–¥—Ä–µ—Å–æ–≤–∞–Ω–æ —Ö—Ä–∏—Å—Ç–∏–∞–Ω–∞–º, —Ä–∞—Å—Å–µ—è–Ω–Ω—ã–º –≤ –ø—Ä–æ–≤–∏–Ω—Ü–∏—è—Ö –ú–∞–ª–æ–π –ê–∑–∏–∏: –ü–æ–Ω—Ç–µ, –ì–∞–ª–∞—Ç–∏–∏, –ö–∞–ø–ø–∞–¥–æ–∫–∏–∏, –ê—Å–∏–∏ –∏ –í–∏—Ñ–∏–Ω–∏–∏ (1 –ü–µ—Ç. 1:1). –≠—Ç–æ –±—ã–ª–∏ –≤–µ—Ä—É—é—â–∏–µ, –ø–µ—Ä–µ–∂–∏–≤–∞–≤—à–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è."
    },
    {
        "question": "–ö–∞–∫–æ–≤–∞ –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å –ø–æ—Å–ª–∞–Ω–∏—è?",
        "options": ["–û—Å—É–¥–∏—Ç—å –ª–∂–µ—É—á–∏—Ç–µ–ª–µ–π", "–£–∫—Ä–µ–ø–∏—Ç—å –≤ —Å—Ç—Ä–∞–¥–∞–Ω–∏—è—Ö", "–û–±—ä—è—Å–Ω–∏—Ç—å –¥–æ–∫—Ç—Ä–∏–Ω—ã", "–°–æ–±—Ä–∞—Ç—å –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è"],
        "correct": 1,
        "explanation": "–ì–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî —É–∫—Ä–µ–ø–∏—Ç—å –≤–µ—Ä—É—é—â–∏—Ö –≤ —Å—Ç—Ä–∞–¥–∞–Ω–∏—è—Ö, –Ω–∞–ø–æ–º–Ω–∏—Ç—å –æ –±—É–¥—É—â–µ–π —Å–ª–∞–≤–µ –≤–æ –•—Ä–∏—Å—Ç–µ –∏ –ø—Ä–∏–∑–≤–∞—Ç—å –∫ —Å–≤—è—Ç–æ–π –∂–∏–∑–Ω–∏, –ø–æ—Å–ª—É—à–∞–Ω–∏—é –∏ –Ω–∞–¥–µ–∂–¥–µ –Ω–∞ —Å–ø–∞—Å–µ–Ω–∏–µ."
    },
    {
        "question": "–ß–µ—Ä–µ–∑ —á—Ç–æ –ë–æ–≥ –≤–æ–∑—Ä–æ–¥–∏–ª –Ω–∞—Å –∫ –∂–∏–≤–æ–º—É —É–ø–æ–≤–∞–Ω–∏—é? (1 –ü–µ—Ç. 1:3)",
        "options": ["–ß–µ—Ä–µ–∑ –∫—Ä–µ—â–µ–Ω–∏–µ", "–ß–µ—Ä–µ–∑ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω–∏–µ –•—Ä–∏—Å—Ç–∞", "–ß–µ—Ä–µ–∑ –≤–µ—Ä—É", "–ß–µ—Ä–µ–∑ –°–ª–æ–≤–æ –ë–æ–∂—å–µ"],
        "correct": 1,
        "explanation": "–ë–æ–≥ –≤–æ–∑—Ä–æ–¥–∏–ª –Ω–∞—Å '–≤–æ—Å–∫—Ä–µ—Å–µ–Ω–∏–µ–º –ò–∏—Å—É—Å–∞ –•—Ä–∏—Å—Ç–∞ –∏–∑ –º—ë—Ä—Ç–≤—ã—Ö –∫ —É–ø–æ–≤–∞–Ω–∏—é –∂–∏–≤–æ–º—É' (1 –ü–µ—Ç. 1:3). –ù–∞—à–∞ –Ω–∞–¥–µ–∂–¥–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –≤–æ—Å–∫—Ä–µ—Å—à–µ–º –•—Ä–∏—Å—Ç–µ, –∞ –Ω–µ –Ω–∞ –∑–µ–º–Ω—ã—Ö –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞—Ö."
    },
    {
        "question": "–ö–∞–∫–æ–µ –Ω–∞—Å–ª–µ–¥–∏–µ –æ–∂–∏–¥–∞–µ—Ç –≤–µ—Ä—É—é—â–∏—Ö? (1 –ü–µ—Ç. 1:4)",
        "options": ["–ó–µ–º–Ω–æ–µ –±–æ–≥–∞—Ç—Å—Ç–≤–æ", "–ù–µ—Ç–ª–µ–Ω–Ω–æ–µ, —á–∏—Å—Ç–æ–µ, –Ω–µ—É–≤—è–¥–∞–µ–º–æ–µ", "–î–æ–ª–≥–∞—è –∂–∏–∑–Ω—å", "–í–ª–∞—Å—Ç—å –Ω–∞–¥ –Ω–∞—Ä–æ–¥–∞–º–∏"],
        "correct": 1,
        "explanation": "–í–µ—Ä—É—é—â–∏—Ö –æ–∂–∏–¥–∞–µ—Ç '–Ω–∞—Å–ª–µ–¥—Å—Ç–≤–æ –Ω–µ—Ç–ª–µ–Ω–Ω–æ–µ, —á–∏—Å—Ç–æ–µ, –Ω–µ—É–≤—è–¥–∞–µ–º–æ–µ, —Ö—Ä–∞–Ω—è—â–µ–µ—Å—è –Ω–∞ –Ω–µ–±–µ—Å–∞—Ö' (1 –ü–µ—Ç. 1:4). –≠—Ç–æ –Ω–µ –∑–µ–º–Ω–æ–µ –±–æ–≥–∞—Ç—Å—Ç–≤–æ, –∞ –≤–µ—á–Ω–∞—è —ç—Å—Ö–∞—Ç–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –Ω–∞–¥–µ–∂–¥–∞ –Ω–∞ –Ω–æ–≤–æ–µ –Ω–µ–±–æ –∏ –Ω–æ–≤—É—é –∑–µ–º–ª—é."
    },
    {
        "question": "–ö–∞–∫ –≤–µ—Ä—É—é—â–∏–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–æ —Å–ø–∞—Å–µ–Ω–∏—é? (1 –ü–µ—Ç. 1:5)",
        "options": ["–ü–µ—Ä–µ–Ω–æ—Å—è –≤–µ—Ä–Ω–æ —Å—Ç—Ä–∞–¥–∞–Ω–∏—è", "–°–∏–ª–æ—é –ë–æ–∂–∏–µ–π –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –∏—Ö –≤–µ—Ä—ã", "–ß–µ—Ä–µ–∑ –ü—Ä–∏—á–∞—Å—Ç–∏–µ", "–î–æ–±—Ä—ã–º–∏ –¥–µ–ª–∞–º–∏"],
        "correct": 1,
        "explanation": "–í–µ—Ä—É—é—â–∏–µ '—Å–∏–ª–æ—é –ë–æ–∂–∏–µ—é —á–µ—Ä–µ–∑ –≤–µ—Ä—É —Å–æ–±–ª—é–¥–∞–µ–º—ã –∫–æ —Å–ø–∞—Å–µ–Ω–∏—é' (1 –ü–µ—Ç. 1:5). –ë–æ–≥ —Å–∏–ª–æ–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞—Å –¥–ª—è –≤–µ—á–Ω–æ–≥–æ —Å–ø–∞—Å–µ–Ω–∏—è ‚Äî —ç—Ç–æ –¥–∞—Ä –ë–æ–∂–∏–π, –∞ –Ω–µ –Ω–∞—à–∞ –∑–∞—Å–ª—É–≥–∞."
    },
    {
        "question": "–ö —á–µ–º—É –ø—Ä–∏–∑—ã–≤–∞–µ—Ç –ü–µ—Ç—Ä –≤–µ—Ä—É—é—â–∏—Ö? (1 –ü–µ—Ç. 1:15-16)",
        "options": ["–ö –±–æ–≥–∞—Ç—Å—Ç–≤—É", "–ö —Å–≤—è—Ç–æ—Å—Ç–∏", "–ö —Ç–µ—Ä–ø–µ–Ω–∏—é", "–ö –∑–Ω–∞–Ω–∏—é"],
        "correct": 1,
        "explanation": "'–ü–æ –ø—Ä–∏–º–µ—Ä—É –ø—Ä–∏–∑–≤–∞–≤—à–µ–≥–æ –≤–∞—Å –°–≤—è—Ç–æ–≥–æ, –∏ —Å–∞–º–∏ –±—É–¥—å—Ç–µ —Å–≤—è—Ç—ã –≤–æ –≤—Å–µ—Ö –ø–æ—Å—Ç—É–ø–∫–∞—Ö. –ò–±–æ –Ω–∞–ø–∏—Å–∞–Ω–æ: –±—É–¥—å—Ç–µ —Å–≤—è—Ç—ã, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ø —Å–≤—è—Ç' (1 –ü–µ—Ç. 1:15-16). –°–≤—è—Ç–æ—Å—Ç—å ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ –æ—Ç –≥—Ä–µ—Ö–∞ –∏ –ø–æ–¥—Ä–∞–∂–∞–Ω–∏–µ –ë–æ–∂—å–µ–π —Å–≤—è—Ç–æ—Å—Ç–∏."
    }
]

# –°–†–ï–î–ù–ò–ô –£–†–û–í–ï–ù–¨
medium_questions = [
    {
        "question": "–ü–æ—á–µ–º—É –ü–µ—Ç—Ä –Ω–∞–∑–≤–∞–ª –†–∏–º '–í–∞–≤–∏–ª–æ–Ω–æ–º'?",
        "options": ["–≠—Ç–æ –º–µ—Ç–∞—Ñ–æ—Ä–∞ –∏–¥–æ–ª–æ–ø–æ–∫–ª–æ–Ω—Å—Ç–≤–∞, —Ü–µ–Ω—Ç—Ä–∞ —è–∑—ã—á–µ—Å–∫–æ–π –≤–ª–∞—Å—Ç–∏", "–†–∏–º –±—ã–ª –æ—Å–Ω–æ–≤–∞–Ω –≤–∞–≤–∏–ª–æ–Ω—è–Ω–∞–º–∏", "–ü–µ—Ç—Ä –æ—à–∏–±—Å—è", "–û–Ω –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –∏ —Å–∏–¥–µ–ª –≤ –í–∞–≤–∏–ª–æ–Ω–µ, –∞ –Ω–µ –≤ –†–∏–º–µ"],
        "correct": 0,
        "explanation": "–í–∞–≤–∏–ª–æ–Ω ‚Äî —ç—Ç–æ –∫–æ–¥–æ–≤–æ–µ –∏–º—è –¥–ª—è –†–∏–º–∞. –í–æ –≤—Ä–µ–º–µ–Ω–∞ –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π –∞–≤—Ç–æ—Ä—ã –∏–∑–±–µ–≥–∞–ª–∏ –ø—Ä—è–º—ã—Ö —É–∫–∞–∑–∞–Ω–∏–π –Ω–∞ –º–µ—Å—Ç–∞ –∏ –∏–º–µ–Ω–∞. –í–∞–≤–∏–ª–æ–Ω —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä–æ–≤–∞–ª –†–∏–º –∏–∑-–∑–∞ –µ–≥–æ –∏–¥–æ–ª–æ–ø–æ–∫–ª–æ–Ω—Å—Ç–≤–∞ –∏ —è–∑—ã—á–µ—Å–∫–æ–π –≤–ª–∞—Å—Ç–∏ (—Å—Ä. –û—Ç–∫—Ä. 17:18)."
    },
    {
        "question": "–ü—Ä–∏ –∫–∞–∫–æ–º –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–µ –Ω–∞—á–∞–ª–∏—Å—å –º–∞—Å—Å–æ–≤—ã–µ –≥–æ–Ω–µ–Ω–∏—è –Ω–∞ —Ö—Ä–∏—Å—Ç–∏–∞–Ω?",
        "options": ["–ö–ª–∞–≤–¥–∏–π", "–ù–µ—Ä–æ–Ω", "–î–æ–º–∏—Ü–∏–∞–Ω", "–¢—Ä–∞—è–Ω"],
        "correct": 1,
        "explanation": "–ú–∞—Å—Å–æ–≤—ã–µ –≥–æ–Ω–µ–Ω–∏—è –Ω–∞—á–∞–ª–∏—Å—å –ø—Ä–∏ –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–µ –ù–µ—Ä–æ–Ω–µ –≤ 64 –≥. –Ω.—ç., –ø–æ—Å–ª–µ –ø–æ–∂–∞—Ä–∞ –†–∏–º–∞. –ù–µ—Ä–æ–Ω –æ–±–≤–∏–Ω–∏–ª —Ö—Ä–∏—Å—Ç–∏–∞–Ω –≤ –ø–æ–¥–∂–æ–≥–µ –∏ –Ω–∞—á–∞–ª –∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ. –ü–µ—Ç—Ä –∏ –ü–∞–≤–µ–ª –ø—Ä–∏–Ω—è–ª–∏ –º—É—á–µ–Ω–∏—á–µ—Å–∫—É—é —Å–º–µ—Ä—Ç—å –ø—Ä–∏ –ù–µ—Ä–æ–Ω–µ."
    },
    {
        "question": "–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –≥—Ä–µ—á–µ—Å–∫–æ–µ —Å–ª–æ–≤–æ 'œÄœÅœåŒ≥ŒΩœâœÉŒπœÇ' (–ø—Ä–µ–¥–≤–µ–¥–µ–Ω–∏–µ)?",
        "options": ["–ü—Ä–æ—Å—Ç–æ–µ –ø—Ä–µ–¥–≤–∏–¥–µ–Ω–∏–µ", "–ò–∑–±—Ä–∞–Ω–∏–µ –ø–æ –∑–∞–≤–µ—Ç–Ω–æ–π –ª—é–±–≤–∏", "–ó–Ω–∞–Ω–∏–µ –±—É–¥—É—â–µ–≥–æ", "–ë–æ–∂—å—è –º—É–¥—Ä–æ—Å—Ç—å"],
        "correct": 1,
        "explanation": "–ì—Ä–µ—á–µ—Å–∫–æ–µ 'œÄœÅœåŒ≥ŒΩœâœÉŒπœÇ' –æ–∑–Ω–∞—á–∞–µ—Ç –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–µ–¥–≤–∏–¥–µ–Ω–∏–µ, –∞ –∏–∑–±—Ä–∞–Ω–∏–µ –ø–æ –∑–∞–≤–µ—Ç–Ω–æ–π –ª—é–±–≤–∏ (1 –ü–µ—Ç. 1:2). –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ë–æ–∂—å—é –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É –≤ —Å–ø–∞—Å–µ–Ω–∏–∏ ‚Äî –û–Ω –∏–∑–±—Ä–∞–ª –Ω–∞—Å –ø–æ –°–≤–æ–µ–π –ª—é–±–≤–∏ –µ—â—ë –¥–æ —Å–æ–∑–¥–∞–Ω–∏—è –º–∏—Ä–∞."
    },
    {
        "question": "–ö—Ç–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–ª –ø—Ä–æ—Ä–æ—á–µ—Å—Ç–≤–∞ –æ —Å–ø–∞—Å–µ–Ω–∏–∏? (1 –ü–µ—Ç. 1:10)",
        "options": ["–ê–ø–æ—Å—Ç–æ–ª—ã", "–ü—Ä–æ—Ä–æ–∫–∏", "–ê–Ω–≥–µ–ª—ã", "–ü–µ—Ä–≤–æ—Å–≤—è—â–µ–Ω–Ω–∏–∫–∏"],
        "correct": 1,
        "explanation": "'–ö —Å–µ–º—É-—Ç–æ —Å–ø–∞—Å–µ–Ω–∏—é –æ—Ç–Ω–æ—Å–∏–ª–∏—Å—å –∏–∑—ã—Å–∫–∞–Ω–∏—è –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ä–æ–∫–æ–≤' (1 –ü–µ—Ç. 1:10). –ü—Ä–æ—Ä–æ–∫–∏ —Ç—â–∞—Ç–µ–ª—å–Ω–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–ª–∏ —Å–≤–æ–∏ –ø—Ä–æ—Ä–æ—á–µ—Å—Ç–≤–∞, –Ω–æ –Ω–µ –∑–Ω–∞–ª–∏ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è (—Å—Ä. –î–∞–Ω. 12:8)."
    },
    {
        "question": "–ß—Ç–æ —É–∫–∞–∑—ã–≤–∞–ª –î—É—Ö –•—Ä–∏—Å—Ç–æ–≤ –≤ –ø—Ä–æ—Ä–æ–∫–∞—Ö? (1 –ü–µ—Ç. 1:11)",
        "options": ["–¢–æ–ª—å–∫–æ —Å—Ç—Ä–∞–¥–∞–Ω–∏—è –•—Ä–∏—Å—Ç–∞", "–¢–æ–ª—å–∫–æ —Å–ª–∞–≤—É –•—Ä–∏—Å—Ç–∞", "–°—Ç—Ä–∞–¥–∞–Ω–∏—è –∏ –ø–æ—Å–ª–µ–¥—É—é—â—É—é —Å–ª–∞–≤—É", "–ö–æ–Ω–µ—Ü –º–∏—Ä–∞"],
        "correct": 2,
        "explanation": "–î—É—Ö –•—Ä–∏—Å—Ç–æ–≤ '–ø—Ä–µ–¥–≤–æ–∑–≤–µ—â–∞–ª –•—Ä–∏—Å—Ç–æ–≤—ã —Å—Ç—Ä–∞–¥–∞–Ω–∏—è –∏ –ø–æ—Å–ª–µ–¥—É—é—â—É—é –∑–∞ –Ω–∏–º–∏ —Å–ª–∞–≤—É' (1 –ü–µ—Ç. 1:11). –°—Ç—Ä–∞–¥–∞–Ω–∏—è –ú–µ—Å—Å–∏–∏ –∏ –ï–≥–æ –ø—Ä–æ—Å–ª–∞–≤–ª–µ–Ω–∏–µ ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ç–µ–º–∞ –ø—Ä–æ—Ä–æ—á–µ—Å—Ç–≤ –í–µ—Ç—Ö–æ–≥–æ –ó–∞–≤–µ—Ç–∞."
    },
    {
        "question": "–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç '–ø—Ä–µ–ø–æ—è—Å–∞—Ç—å —á—Ä–µ—Å–ª–∞ —É–º–∞'? (1 –ü–µ—Ç. 1:13)",
        "options": ["–ú–æ–ª–∏—Ç—å—Å—è —É—Å–µ—Ä–¥–Ω–µ–µ", "–ë—ã—Ç—å —Å–æ–±—Ä–∞–Ω–Ω—ã–º –¥—É—Ö–æ–≤–Ω–æ, –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –º—ã—à–ª–µ–Ω–∏–∏", "–ò–∑—É—á–∞—Ç—å –ü–∏—Å–∞–Ω–∏–µ", "–ü–æ—Å—Ç–∏—Ç—å—Å—è"],
        "correct": 1,
        "explanation": "'–ü—Ä–µ–ø–æ—è—Å–∞–≤ —á—Ä–µ—Å–ª–∞ —É–º–∞ –≤–∞—à–µ–≥–æ, –±–æ–¥—Ä—Å—Ç–≤—É—è...' (1 –ü–µ—Ç. 1:13) ‚Äî –æ–±—Ä–∞–∑ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –¥–µ–π—Å—Ç–≤–∏—é, –∫–∞–∫ –ø—Ä–∏ –ò—Å—Ö–æ–¥–µ –∏–∑ –ï–≥–∏–ø—Ç–∞. –≠—Ç–æ –ø—Ä–∏–∑—ã–≤ –∫ –¥—É—Ö–æ–≤–Ω–æ–π —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç–∏, –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏—é —É–º–∞ –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –¥—É—Ö–æ–≤–Ω–æ–π –±–æ—Ä—å–±–µ."
    },
    {
        "question": "–° —á–µ–º —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è –∏—Å–ø—ã—Ç–∞–Ω–∏–µ –≤–µ—Ä—ã? (1 –ü–µ—Ç. 1:7)",
        "options": ["–° –æ—á–∏—â–µ–Ω–∏–µ–º —Å–µ—Ä–µ–±—Ä–∞", "–° –æ—á–∏—â–µ–Ω–∏–µ–º –∑–æ–ª–æ—Ç–∞ –æ–≥–Ω–µ–º", "–° –æ–≥—Ä–∞–Ω–∫–æ–π –∞–ª–º–∞–∑–∞", "–° –∑–∞–∫–∞–ª–∏–≤–∞–Ω–∏–µ–º —Å—Ç–∞–ª–∏"],
        "correct": 1,
        "explanation": "'–ò—Å–ø—ã—Ç–∞–Ω–Ω–∞—è –≤–µ—Ä–∞ –≤–∞—à–∞ –æ–∫–∞–∑–∞–ª–∞—Å—å –¥—Ä–∞–≥–æ—Ü–µ–Ω–Ω–µ–µ –≥–∏–±–Ω—É—â–µ–≥–æ, —Ö–æ—Ç—è –∏ –æ–≥–Ω–µ–º –∏—Å–ø—ã—Ç—ã–≤–∞–µ–º–æ–≥–æ –∑–æ–ª–æ—Ç–∞' (1 –ü–µ—Ç. 1:7). –ö–∞–∫ –∑–æ–ª–æ—Ç–æ –æ—á–∏—â–∞–µ—Ç—Å—è –æ—Ç –ø—Ä–∏–º–µ—Å–µ–π –≤ –æ–≥–Ω–µ, —Ç–∞–∫ –≤–µ—Ä–∞ –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç—Å—è –∏ –æ—á–∏—â–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å—Ç—Ä–∞–¥–∞–Ω–∏—è."
    },
    {
        "question": "–û—Ç–∫—É–¥–∞ –≤–∑—è—Ç–∞ —Ü–∏—Ç–∞—Ç–∞ '–±—É–¥—å—Ç–µ —Å–≤—è—Ç—ã, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ø —Å–≤—è—Ç'?",
        "options": ["–ò—Å—Ö–æ–¥", "–õ–µ–≤–∏—Ç", "–í—Ç–æ—Ä–æ–∑–∞–∫–æ–Ω–∏–µ", "–ü—Å–∞–ª–º—ã"],
        "correct": 1,
        "explanation": "–¶–∏—Ç–∞—Ç–∞ –≤–∑—è—Ç–∞ –∏–∑ –∫–Ω–∏–≥–∏ –õ–µ–≤–∏—Ç (11:44-45; 19:2; 20:7,26). –ü–µ—Ç—Ä –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ø—Ä–∏–∑—ã–≤ –∫ —Å–≤—è—Ç–æ—Å—Ç–∏ –∏–∑ –í–µ—Ç—Ö–æ–≥–æ –ó–∞–≤–µ—Ç–∞ –∫ —Ö—Ä–∏—Å—Ç–∏–∞–Ω–∞–º, –ø–æ–∫–∞–∑—ã–≤–∞—è, —á—Ç–æ –æ–Ω–∏ ‚Äî —Å–≤—è—Ç–æ–π –Ω–∞—Ä–æ–¥ –ë–æ–∂–∏–π."
    },
    {
        "question": "–ß—Ç–æ —è–≤–ª—è–µ—Ç—Å—è —Ü–µ–ª—å—é –≤–µ—Ä—ã? (1 –ü–µ—Ç. 1:9)",
        "options": ["–ë–æ–≥–∞—Ç—Å—Ç–≤–æ", "–ó–¥–æ—Ä–æ–≤—å–µ", "–°–ø–∞—Å–µ–Ω–∏–µ –¥—É—à", "–ú—É–¥—Ä–æ—Å—Ç—å"],
        "correct": 2,
        "explanation": "'–î–æ—Å—Ç–∏–≥–∞—è –Ω–∞–∫–æ–Ω–µ—Ü –≤–µ—Ä–æ—é –≤–∞—à–µ—é —Å–ø–∞—Å–µ–Ω–∏—è –¥—É—à' (1 –ü–µ—Ç. 1:9). –ö–æ–Ω–µ—á–Ω–∞—è —Ü–µ–ª—å –≤–µ—Ä—ã ‚Äî –Ω–µ –∑–µ–º–Ω–æ–µ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ, –∞ –≤–µ—á–Ω–æ–µ —Å–ø–∞—Å–µ–Ω–∏–µ –¥—É—à–∏, –∫–æ—Ç–æ—Ä–æ–µ –º—ã –ø–æ–ª—É—á–∏–º –ø—Ä–∏ —è–≤–ª–µ–Ω–∏–∏ –•—Ä–∏—Å—Ç–∞."
    },
    {
        "question": "–ö—Ç–æ –∂–µ–ª–∞–µ—Ç –ø—Ä–æ–Ω–∏–∫–Ω—É—Ç—å –≤ —Ç–∞–π–Ω—É —Å–ø–∞—Å–µ–Ω–∏—è? (1 –ü–µ—Ç. 1:12)",
        "options": ["–î–µ–º–æ–Ω—ã", "–ê–Ω–≥–µ–ª—ã", "–õ—é–¥–∏", "–ü—Ä–æ—Ä–æ–∫–∏"],
        "correct": 1,
        "explanation": "'–í–æ —á—Ç–æ –∂–µ–ª–∞—é—Ç –ø—Ä–æ–Ω–∏–∫–Ω—É—Ç—å –ê–Ω–≥–µ–ª—ã' (1 –ü–µ—Ç. 1:12). –ì—Ä–µ—á–µ—Å–∫–æ–µ 'œÄŒ±œÅŒ±Œ∫œçœàŒ±Œπ' –æ–∑–Ω–∞—á–∞–µ—Ç –±–ª–∞–≥–æ–≥–æ–≤–µ–π–Ω–æ–µ –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ. –î–∞–∂–µ –∞–Ω–≥–µ–ª—ã —Å –∏–Ω—Ç–µ—Ä–µ—Å–æ–º –∏—Å—Å–ª–µ–¥—É—é—Ç —Ç–∞–π–Ω—É —Å–ø–∞—Å–µ–Ω–∏—è, –¥–æ—Å—Ç—É–ø–Ω—É—é –≤–µ—Ä—É—é—â–∏–º."
    }
]

# –°–õ–û–ñ–ù–´–ô –£–†–û–í–ï–ù–¨
hard_questions = [
    {
        "question": "–ö–∞–∫–∏–µ —Ç—Ä–∏ –¥–µ–π—Å—Ç–≤–∏—è –¢—Ä–æ–∏—Ü—ã –æ–ø–∏—Å–∞–Ω—ã –≤ 1 –ü–µ—Ç. 1:2?",
        "options": [
            "–¢–≤–æ—Ä–µ–Ω–∏–µ, –∏—Å–∫—É–ø–ª–µ–Ω–∏–µ, –æ—Å–≤—è—â–µ–Ω–∏–µ",
            "–ü—Ä–µ–¥–≤–µ–¥–µ–Ω–∏–µ –û—Ç—Ü–∞, –æ—Å–≤—è—â–µ–Ω–∏–µ –î—É—Ö–∞, –æ–∫—Ä–æ–ø–ª–µ–Ω–∏–µ –∫—Ä–æ–≤—å—é –•—Ä–∏—Å—Ç–∞",
            "–ò–∑–±—Ä–∞–Ω–∏–µ, –ø—Ä–∏–∑–≤–∞–Ω–∏–µ, –ø—Ä–æ—Å–ª–∞–≤–ª–µ–Ω–∏–µ",
            "–í–µ—Ä–∞, –Ω–∞–¥–µ–∂–¥–∞, –ª—é–±–æ–≤—å"
        ],
        "correct": 1,
        "explanation": "'–ò–∑–±—Ä–∞–Ω–Ω—ã–º, –ø–æ –ø—Ä–µ–¥–≤–µ–¥–µ–Ω–∏—é –ë–æ–≥–∞ –û—Ç—Ü–∞, –ø—Ä–∏ –æ—Å–≤—è—â–µ–Ω–∏–∏ –æ—Ç –î—É—Ö–∞, –∫ –ø–æ—Å–ª—É—à–∞–Ω–∏—é –∏ –æ–∫—Ä–æ–ø–ª–µ–Ω–∏—é –ö—Ä–æ–≤–∏—é –ò–∏—Å—É—Å–∞ –•—Ä–∏—Å—Ç–∞' (1 –ü–µ—Ç. 1:2). –°–ø–∞—Å–µ–Ω–∏–µ ‚Äî —Ç—Ä–æ–∏—á–Ω–æ–µ –¥–µ–ª–æ: –û—Ç–µ—Ü –∏–∑–±–∏—Ä–∞–µ—Ç, –î—É—Ö –æ—Å–≤—è—â–∞–µ—Ç, –°—ã–Ω –∏—Å–∫—É–ø–∞–µ—Ç."
    },
    {
        "question": "–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –≥—Ä–µ—á–µ—Å–∫–æ–µ —Å–ª–æ–≤–æ 'œÄŒ±œÅŒ±Œ∫œçœàŒ±Œπ' (–∂–µ–ª–∞—é—Ç –ø—Ä–æ–Ω–∏–∫–Ω—É—Ç—å) –≤ 1 –ü–µ—Ç. 1:12?",
        "options": [
            "–°—Ç—Ä–∞—Ö –∏ —Ç—Ä–µ–ø–µ—Ç",
            "–ë–ª–∞–≥–æ–≥–æ–≤–µ–π–Ω–æ–µ –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ",
            "–ì–ª—É–±–æ–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ",
            "–ù–µ–¥–æ—É–º–µ–Ω–∏–µ"
        ],
        "correct": 1,
        "explanation": "–ì—Ä–µ—á–µ—Å–∫–æ–µ 'œÄŒ±œÅŒ±Œ∫œçœàŒ±Œπ' –±—É–∫–≤–∞–ª—å–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç '–Ω–∞–∫–ª–æ–Ω–∏—Ç—å—Å—è, —á—Ç–æ–±—ã –∑–∞–≥–ª—è–Ω—É—Ç—å'. –≠—Ç–æ –≤—ã—Ä–∞–∂–∞–µ—Ç –±–ª–∞–≥–æ–≥–æ–≤–µ–π–Ω–æ–µ –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–æ –∞–Ω–≥–µ–ª–æ–≤ –∫ —Ç–∞–π–Ω–µ —Å–ø–∞—Å–µ–Ω–∏—è. –î–∞–∂–µ –Ω–µ–±–µ—Å–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤–∞ –∂–µ–ª–∞—é—Ç –≥–ª—É–±–∂–µ –ø–æ–Ω—è—Ç—å –ë–æ–∂–∏–π –ø–ª–∞–Ω –∏—Å–∫—É–ø–ª–µ–Ω–∏—è."
    },
    {
        "question": "–ü–æ—á–µ–º—É –ü–µ—Ç—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –æ–±—Ä–∞–∑ '–ø—Ä–µ–ø–æ—è—Å–∞–Ω–∏—è —á—Ä–µ—Å–µ–ª'?",
        "options": [
            "–≠—Ç–æ –±—ã–ª–∞ –æ–±—ã—á–Ω–∞—è –æ–¥–µ–∂–¥–∞ —Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏",
            "–û–±—Ä–∞–∑ –≤–æ–∏–Ω—Å–∫–æ–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏",
            "–û–±—Ä–∞–∑ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –ò—Å—Ö–æ–¥—É –∏–∑ –ï–≥–∏–ø—Ç–∞",
            "–°–∏–º–≤–æ–ª —Å–∫—Ä–æ–º–Ω–æ—Å—Ç–∏"
        ],
        "correct": 2,
        "explanation": "–û–±—Ä–∞–∑ '–ø—Ä–µ–ø–æ—è—Å–∞–Ω–∏—è —á—Ä–µ—Å–µ–ª' –æ—Ç—Å—ã–ª–∞–µ—Ç –∫ –ò—Å—Ö–æ–¥—É (–ò—Å—Ö. 12:11), –∫–æ–≥–¥–∞ –∏–∑—Ä–∞–∏–ª—å—Ç—è–Ω–µ –µ–ª–∏ –ø–∞—Å—Ö—É, –±—É–¥—É—á–∏ –≥–æ—Ç–æ–≤—ã –∫ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–º—É –≤—ã—Ö–æ–¥—É –∏–∑ –ï–≥–∏–ø—Ç–∞. –ü–µ—Ç—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç –æ–±—Ä–∞–∑ –¥–ª—è –ø—Ä–∏–∑—ã–≤–∞ –∫ –¥—É—Ö–æ–≤–Ω–æ–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∏ –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏—é."
    },
    {
        "question": "–ß—Ç–æ –ü–µ—Ç—Ä –ù–ï —É–ø–æ–º—è–Ω—É–ª –∫–∞–∫ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É –Ω–µ–±–µ—Å–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–∏—è?",
        "options": ["–ù–µ—Ç–ª–µ–Ω–Ω–æ–µ", "–ß–∏—Å—Ç–æ–µ", "–ù–µ—É–≤—è–¥–∞–µ–º–æ–µ", "–ë–µ–∑–≥—Ä–µ—à–Ω–æ–µ"],
        "correct": 3,
        "explanation": "–ü–µ—Ç—Ä –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞—Å–ª–µ–¥–∏–µ –∫–∞–∫ '–Ω–µ—Ç–ª–µ–Ω–Ω–æ–µ, —á–∏—Å—Ç–æ–µ, –Ω–µ—É–≤—è–¥–∞–µ–º–æ–µ' (1 –ü–µ—Ç. 1:4). –°–ª–æ–≤–æ '–±–µ–∑–≥—Ä–µ—à–Ω–æ–µ' –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, —Ö–æ—Ç—è '–Ω–µ—Ç–ª–µ–Ω–Ω–æ—Å—Ç—å' —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤–µ—á–Ω—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å, –ø–æ–¥–æ–±–Ω—É—é –±–µ–∑–≥—Ä–µ—à–Ω–æ—Å—Ç–∏ –•—Ä–∏—Å—Ç–∞ (–ï–≤—Ä. 7:26)."
    },
    {
        "question": "–ö–∞–∫–æ–µ —Å–ª–æ–≤–æ –∏–∑ –°–∏—Ä–∞—Ö–∞ 2:5 (–Ω–µ–∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∞—è –∫–Ω–∏–≥–∞) –ø–µ—Ä–µ–∫–ª–∏–∫–∞–µ—Ç—Å—è —Å —É—á–µ–Ω–∏–µ–º –æ —Å—Ç—Ä–∞–¥–∞–Ω–∏—è—Ö –≤ 1 –ü–µ—Ç. 1:7?",
        "options": [
            "–ó–æ–ª–æ—Ç–æ –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –æ–≥–Ω–µ",
            "–¢–µ—Ä–ø–µ–Ω–∏–µ —Ä–æ–∂–¥–∞–µ—Ç –æ–ø—ã—Ç–Ω–æ—Å—Ç—å",
            "–°—Ç—Ä–∞–¥–∞–Ω–∏–µ –æ—á–∏—â–∞–µ—Ç –¥—É—à—É",
            "–í–µ—Ä–∞ –±–µ–∑ –¥–µ–ª –º–µ—Ä—Ç–≤–∞"
        ],
        "correct": 0,
        "explanation": "–í –°–∏—Ä. 2:5 —Å–∫–∞–∑–∞–Ω–æ: '–ó–æ–ª–æ—Ç–æ –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –æ–≥–Ω–µ'. –ü–µ—Ç—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∂–µ –æ–±—Ä–∞–∑: –≤–µ—Ä–∞ –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–¥–∞–Ω–∏—è–º–∏, –∫–∞–∫ –∑–æ–ª–æ—Ç–æ –æ–≥–Ω—ë–º, —á—Ç–æ–±—ã –æ—á–∏—Å—Ç–∏—Ç—å—Å—è –æ—Ç –ø—Ä–∏–º–µ—Å–µ–π –∏ —è–≤–∏—Ç—å —Å–≤–æ—é –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å."
    },
    {
        "question": "–í –∫–∞–∫–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ü–µ—Ç—Ä –≥–æ–≤–æ—Ä–∏—Ç –æ '–∂–∏–≤–æ–π –Ω–∞–¥–µ–∂–¥–µ'?",
        "options": [
            "–ù–∞–¥–µ–∂–¥–∞ –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ –∂–∏–∑–Ω–∏",
            "–ù–∞–¥–µ–∂–¥–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –≤–æ—Å–∫—Ä–µ—Å—à–µ–º –•—Ä–∏—Å—Ç–µ",
            "–ù–∞–¥–µ–∂–¥–∞ –Ω–∞ –∏–∑–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç —Å—Ç—Ä–∞–¥–∞–Ω–∏–π",
            "–ù–∞–¥–µ–∂–¥–∞ –Ω–∞ –≤—Ç–æ—Ä–æ–µ –ø—Ä–∏—à–µ—Å—Ç–≤–∏–µ"
        ],
        "correct": 1,
        "explanation": "'–í–æ–∑—Ä–æ–¥–∏–≤—à–∏–π –Ω–∞—Å –≤–æ—Å–∫—Ä–µ—Å–µ–Ω–∏–µ–º –ò–∏—Å—É—Å–∞ –•—Ä–∏—Å—Ç–∞ –∏–∑ –º–µ—Ä—Ç–≤—ã—Ö –∫ —É–ø–æ–≤–∞–Ω–∏—é –∂–∏–≤–æ–º—É' (1 –ü–µ—Ç. 1:3). '–ñ–∏–≤–∞—è –Ω–∞–¥–µ–∂–¥–∞' –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–º —Å–æ–±—ã—Ç–∏–∏ ‚Äî –≤–æ—Å–∫—Ä–µ—Å–µ–Ω–∏–∏ –•—Ä–∏—Å—Ç–∞, –∞ –Ω–µ –Ω–∞ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã—Ö –æ–∂–∏–¥–∞–Ω–∏—è—Ö –∏–ª–∏ –∑–µ–º–Ω—ã—Ö –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞—Ö."
    },
    {
        "question": "–ö–∞–∫ —Å–≤—è–∑–∞–Ω—ã —Å—Ç—Ä–∞–¥–∞–Ω–∏—è –•—Ä–∏—Å—Ç–∞ –∏ –ï–≥–æ —Å–ª–∞–≤–∞ –≤ –ø—Ä–æ—Ä–æ—á–µ—Å—Ç–≤–∞—Ö –ø–æ 1 –ü–µ—Ç. 1:11?",
        "options": [
            "–°–ª–∞–≤–∞ –±–µ–∑ —Å—Ç—Ä–∞–¥–∞–Ω–∏–π",
            "–°—Ç—Ä–∞–¥–∞–Ω–∏—è –±–µ–∑ —Å–ª–∞–≤—ã",
            "–°–Ω–∞—á–∞–ª–∞ —Å—Ç—Ä–∞–¥–∞–Ω–∏—è, –ø–æ—Ç–æ–º —Å–ª–∞–≤–∞",
            "–°–ª–∞–≤–∞ –∑–∞–º–µ–Ω—è–µ—Ç —Å—Ç—Ä–∞–¥–∞–Ω–∏—è"
        ],
        "correct": 2,
        "explanation": "–î—É—Ö –•—Ä–∏—Å—Ç–æ–≤ –ø—Ä–µ–¥–≤–æ–∑–≤–µ—â–∞–ª '–•—Ä–∏—Å—Ç–æ–≤—ã —Å—Ç—Ä–∞–¥–∞–Ω–∏—è –∏ –ø–æ—Å–ª–µ–¥—É—é—â—É—é –∑–∞ –Ω–∏–º–∏ —Å–ª–∞–≤—É' (1 –ü–µ—Ç. 1:11). –ü—Ä–æ—Ä–æ—á–µ—Å—Ç–≤–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: —Å–Ω–∞—á–∞–ª–∞ —Å—Ç—Ä–∞–¥–∞–Ω–∏—è –ú–µ—Å—Å–∏–∏, –∑–∞—Ç–µ–º –ï–≥–æ –ø—Ä–æ—Å–ª–∞–≤–ª–µ–Ω–∏–µ (—Å—Ä. –ò—Å. 53; –ü—Å. 21)."
    },
    {
        "question": "–ö–∞–∫–∞—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è –≤–µ—Ä—É—é—â–∏—Ö –ø–æ–¥—á—ë—Ä–∫–Ω—É—Ç–∞ –≤ 1 –ü–µ—Ç. 1:12?",
        "options": [
            "–û–Ω–∏ —É–º–Ω–µ–µ –ø—Ä–æ—Ä–æ–∫–æ–≤",
            "–û–Ω–∏ –∂–∏–≤—É—Ç –≤ —ç–ø–æ—Ö—É –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Ä–æ—á–µ—Å—Ç–≤",
            "–û–Ω–∏ –Ω–µ –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ –ø—Ä–æ—Ä–æ—á–µ—Å—Ç–≤–∞—Ö",
            "–û–Ω–∏ –∑–Ω–∞—é—Ç –±–æ–ª—å—à–µ –∞–Ω–≥–µ–ª–æ–≤"
        ],
        "correct": 1,
        "explanation": "'–ò–º –æ—Ç–∫—Ä—ã—Ç–æ –±—ã–ª–æ, —á—Ç–æ –Ω–µ –∏–º —Å–∞–º–∏–º, –∞ –Ω–∞–º —Å–ª—É–∂–∏–ª–æ —Ç–æ...' (1 –ü–µ—Ç. 1:12). –ü—Ä–∏–≤–∏–ª–µ–≥–∏—è –≤–µ—Ä—É—é—â–∏—Ö –≤ —Ç–æ–º, —á—Ç–æ –æ–Ω–∏ –∂–∏–≤—É—Ç –≤ —ç–ø–æ—Ö—É –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Ä–æ—á–µ—Å—Ç–≤. –ü—Ä–æ—Ä–æ–∫–∏ –∂–µ–ª–∞–ª–∏ —É–≤–∏–¥–µ—Ç—å —Ç–æ, —á—Ç–æ –≤–∏–¥—è—Ç —Ö—Ä–∏—Å—Ç–∏–∞–Ω–µ."
    },
    {
        "question": "–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç '–Ω–µ —Å–æ–æ–±—Ä–∞–∑—É–π—Ç–µ—Å—å —Å –ø—Ä–µ–∂–Ω–∏–º–∏ –ø–æ—Ö–æ—Ç—è–º–∏' –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Å–≤—è—Ç–æ—Å—Ç–∏?",
        "options": [
            "–ü–æ–ª–Ω–æ–µ –±–µ–∑–≥—Ä–µ—à–∏–µ",
            "–û—Ç–¥–µ–ª–µ–Ω–∏–µ –æ—Ç –≥—Ä–µ—Ö–æ–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –ø—Ä–æ—à–ª–æ–≥–æ",
            "–ê—Å–∫–µ—Ç–∏—á–µ—Å–∫–∏–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏",
            "–£—Ö–æ–¥ –æ—Ç –º–∏—Ä–∞"
        ],
        "correct": 1,
        "explanation": "'–ù–µ —Å–æ–æ–±—Ä–∞–∑—É–π—Ç–µ—Å—å —Å –ø—Ä–µ–∂–Ω–∏–º–∏ –ø–æ—Ö–æ—Ç—è–º–∏, –±—ã–≤—à–∏–º–∏ –≤ –Ω–µ–≤–µ–¥–µ–Ω–∏–∏ –≤–∞—à–µ–º' (1 –ü–µ—Ç. 1:14). –≠—Ç–æ –ø—Ä–∏–∑—ã–≤ –æ—Ç–¥–µ–ª–∏—Ç—å—Å—è –æ—Ç –≥—Ä–µ—Ö–æ–≤–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–æ—à–ª–æ–π –∂–∏–∑–Ω–∏, –∫–∞–∫ –ò–∑—Ä–∞–∏–ª—å –æ—Ç–¥–µ–ª—è–ª—Å—è –æ—Ç –æ–±—ã—á–∞–µ–≤ –ï–≥–∏–ø—Ç–∞ –∏ –•–∞–Ω–∞–∞–Ω–∞."
    },
    {
        "question": "–ü–æ—á–µ–º—É –ë–æ–≥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–µ—Ä—É—é—â–∏—Ö '—Å–∏–ª–æ—é –ë–æ–∂–∏–µ–π —á–µ—Ä–µ–∑ –≤–µ—Ä—É' (1 –ü–µ—Ç. 1:5)?",
        "options": [
            "–í–µ—Ä–∞ ‚Äî —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ",
            "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Äî –¥–∞—Ä –ë–æ–∂–∏–π, –∞ –Ω–µ –Ω–∞—à–∞ –∑–∞—Å–ª—É–≥–∞",
            "–ë–æ–≥ –ø–æ–º–æ–≥–∞–µ—Ç —Ç–µ–º, –∫—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–µ–±–µ",
            "–í–µ—Ä–∞ –∑–∞–º–µ–Ω—è–µ—Ç –ë–æ–∂—å—é —Å–∏–ª—É"
        ],
        "correct": 1,
        "explanation": "'–°–∏–ª–æ—é –ë–æ–∂–∏–µ—é —á–µ—Ä–µ–∑ –≤–µ—Ä—É —Å–æ–±–ª—é–¥–∞–µ–º—ã—Ö –∫–æ —Å–ø–∞—Å–µ–Ω–∏—é' (1 –ü–µ—Ç. 1:5). –ú—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º—ã –∫–æ —Å–ø–∞—Å–µ–Ω–∏—é —Å–∏–ª–æ—é –ë–æ–∂–∏–µ–π, –∞ –Ω–µ –Ω–∞—à–µ–π. –í–µ—Ä–∞ ‚Äî —ç—Ç–æ –¥–∞—Ä –ë–æ–∂–∏–π –∏ —Å—Ä–µ–¥—Å—Ç–≤–æ, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä–æ–µ –ë–æ–≥ –¥–µ–π—Å—Ç–≤—É–µ—Ç, –∞ –Ω–µ –Ω–∞—à–∞ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è –∑–∞—Å–ª—É–≥–∞."
    }
]

# –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è)
user_data = {}

# --- –§–£–ù–ö–¶–ò–ò –ë–ê–ó–´ –î–ê–ù–ù–´–• ---

def add_to_leaderboard(user_id, username, first_name, level_key, score, total, time_seconds):
    if collection is None: return

    points_per_question = {"easy": 1, "medium": 2, "hard": 3}
    earned_points = score * points_per_question[level_key]
    user_id_str = str(user_id)
    
    try:
        entry = collection.find_one({"_id": user_id_str})
        
        if entry:
            new_total = entry.get("total_points", 0) + earned_points
            new_attempts = entry.get(f"{level_key}_attempts", 0) + 1
            new_best_score = max(entry.get(f"{level_key}_best_score", 0), score)
            
            current_best_time = entry.get(f"{level_key}_best_time", float('inf'))
            new_best_time = min(current_best_time, time_seconds)
            
            collection.update_one(
                {"_id": user_id_str},
                {
                    "$set": {
                        "total_points": new_total,
                        f"{level_key}_attempts": new_attempts,
                        f"{level_key}_best_score": new_best_score,
                        f"{level_key}_best_time": new_best_time,
                        "last_date": datetime.now().strftime("%Y-%m-%d %H:%M"),
                        "first_name": first_name,
                        "username": username
                    }
                }
            )
        else:
            new_entry = {
                "_id": user_id_str,
                "username": username or "–ë–µ–∑ username",
                "first_name": first_name or "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
                "total_points": earned_points,
                "easy_attempts": 1 if level_key == "easy" else 0,
                "medium_attempts": 1 if level_key == "medium" else 0,
                "hard_attempts": 1 if level_key == "hard" else 0,
                "easy_best_score": score if level_key == "easy" else 0,
                "medium_best_score": score if level_key == "medium" else 0,
                "hard_best_score": score if level_key == "hard" else 0,
                "easy_best_time": time_seconds if level_key == "easy" else float('inf'),
                "medium_best_time": time_seconds if level_key == "medium" else float('inf'),
                "hard_best_time": time_seconds if level_key == "hard" else float('inf'),
                "last_date": datetime.now().strftime("%Y-%m-%d %H:%M")
            }
            collection.insert_one(new_entry)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –ë–î: {e}")

def get_user_position(user_id):
    if collection is None: return None, None
    user_id_str = str(user_id)
    try:
        entry = collection.find_one({"_id": user_id_str})
        if not entry:
            return None, None
        
        my_points = entry.get("total_points", 0)
        count_better = collection.count_documents({"total_points": {"$gt": my_points}})
        return count_better + 1, entry
    except Exception:
        return None, None

def get_leaderboard_page(page_number):
    """–ü–æ–ª—É—á–∞–µ—Ç 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã"""
    if collection is None: return []
    try:
        skip_amount = page_number * 10
        return list(collection.find().sort("total_points", -1).skip(skip_amount).limit(10))
    except Exception:
        return []

def get_total_users():
    """–°—á–∏—Ç–∞–µ—Ç —Å–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–∞–∑–µ"""
    if collection is None: return 0
    try:
        return collection.count_documents({})
    except Exception:
        return 0

def format_time(seconds):
    if seconds == float('inf'):
        return "‚Äî"
    minutes = int(seconds // 60)
    secs = int(seconds % 60)
    if minutes > 0:
        return f"{minutes}–º {secs}—Å"
    return f"{secs}—Å"

# –ö–æ–º–∞–Ω–¥–∞ /start
async def start(update: Update, context):
    keyboard = [
        [InlineKeyboardButton("üìñ –û –±–æ—Ç–µ", callback_data='about')],
        [InlineKeyboardButton("üéØ –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç", callback_data='start_test')],
        [InlineKeyboardButton("üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤", callback_data='leaderboard')],
        [InlineKeyboardButton("üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data='my_stats')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await update.message.reply_text(
        'üìñ *–ë–ò–ë–õ–ï–ô–°–ö–ò–ô –¢–ï–°–¢-–ë–û–¢*\n\n'
        '*–¢–µ–º–∞:* 1 –ü–µ—Ç—Ä–∞ 1:1-16\n'
        '*–ú–∞—Ç–µ—Ä–∏–∞–ª:* –í–≤–µ–¥–µ–Ω–∏–µ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π\n\n'
        '–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:',
        reply_markup=reply_markup,
        parse_mode='Markdown'
    )

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
async def button_handler(update: Update, context):
    query = update.callback_query
    await query.answer()
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü (–µ—Å–ª–∏ –Ω–∞–∂–∞–ª–∏ —Å—Ç—Ä–µ–ª–æ—á–∫—É)
    if query.data.startswith('leaderboard_page_'):
        page = int(query.data.split('_')[2])
        await show_general_leaderboard(query, page)
        return

    if query.data == 'about':
        await query.edit_message_text(
            'üìö *–û –ë–û–¢–ï*\n\n'
            '–≠—Ç–æ—Ç –±–æ—Ç –ø–æ–º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞–Ω–∏—è –ø–æ –ü–µ—Ä–≤–æ–º—É –ø–æ—Å–ª–∞–Ω–∏—é –ü–µ—Ç—Ä–∞ (–≥–ª–∞–≤–∞ 1).\n\n'
            '*–ú–∞—Ç–µ—Ä–∏–∞–ª:*\n'
            '‚Ä¢ –ê–≤—Ç–æ—Ä—Å—Ç–≤–æ –∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç\n'
            '‚Ä¢ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–∞ 1 –ü–µ—Ç. 1:1-16\n'
            '‚Ä¢ –ë–æ–≥–æ—Å–ª–æ–≤—Å–∫–∏–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏\n\n'
            '*–£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:*\n'
            'üü¢ –õ—ë–≥–∫–∏–π ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–∫—Ç—ã (1 –±–∞–ª–ª –∑–∞ –≤–æ–ø—Ä–æ—Å)\n'
            'üü° –°—Ä–µ–¥–Ω–∏–π ‚Äî –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (2 –±–∞–ª–ª–∞ –∑–∞ –≤–æ–ø—Ä–æ—Å)\n'
            'üî¥ –°–ª–æ–∂–Ω—ã–π ‚Äî –≥–ª—É–±–æ–∫–æ–µ –±–æ–≥–æ—Å–ª–æ–≤–∏–µ (3 –±–∞–ª–ª–∞ –∑–∞ –≤–æ–ø—Ä–æ—Å)\n\n'
            '*–°–∏—Å—Ç–µ–º–∞ –±–∞–ª–ª–æ–≤:*\n'
            '‚Ä¢ –ë–∞–ª–ª—ã —Å—É–º–º–∏—Ä—É—é—Ç—Å—è –∑–∞ –≤—Å–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è\n'
            '‚Ä¢ –û–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ –Ω–∞–±—Ä–∞–Ω–Ω—ã–º –±–∞–ª–ª–∞–º\n'
            '‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É —É—Ä–æ–≤–Ω—é\n\n'
            '–ò—Å–ø–æ–ª—å–∑—É–π /test —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å!',
            reply_markup=InlineKeyboardMarkup([[InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data='back_to_main')]]),
            parse_mode='Markdown'
        )
    
    elif query.data == 'start_test':
        await choose_level(update, context, is_callback=True)
    
    elif query.data == 'leaderboard':
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (0)
        await show_general_leaderboard(query, 0)
    
    elif query.data == 'my_stats':
        await show_my_stats(query)

# –ü–æ–∫–∞–∑ –æ–±—â–µ–π —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)
async def show_general_leaderboard(query, page=0):
    users = get_leaderboard_page(page)
    total_users = get_total_users()

    # –û–¢–õ–ê–î–ö–ê: —Å–º–æ—Ç—Ä–∏–º –≤ –ª–æ–≥–∞—Ö Render
    print(f"DEBUG: page={page}, users_on_page={len(users)}, total_users={total_users}")
    
    if not users:
        text = 'üèÜ *–û–ë–©–ê–Ø –¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í*\n\n'
        text += '–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª —Ç–µ—Å—Ç—ã.\n–ë—É–¥—å –ø–µ—Ä–≤—ã–º! üöÄ'
    else:
        text = f'üèÜ *–û–ë–©–ê–Ø –¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í* (–°—Ç—Ä. {page + 1})\n\n'
        
        # –ù–∞—á–∏–Ω–∞–µ–º –Ω—É–º–µ—Ä–∞—Ü–∏—é —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞ (1, 11, 21...)
        start_rank = (page * 10) + 1
        
        for i, entry in enumerate(users, start_rank):
            medal = ""
            if i == 1: medal = "ü•á"
            elif i == 2: medal = "ü•à"
            elif i == 3: medal = "ü•â"
            
            name = entry.get('first_name', 'Unknown')
            if len(name) > 15: name = name[:15] + "..."
            
            text += f'{medal} *{i}.* {name}\n'
            text += f'   üíé {entry.get("total_points", 0)} –±–∞–ª–ª–æ–≤\n'
            
            attempts = []
            if entry.get("easy_attempts", 0) > 0: attempts.append(f'üü¢{entry["easy_attempts"]}')
            if entry.get("medium_attempts", 0) > 0: attempts.append(f'üü°{entry["medium_attempts"]}')
            if entry.get("hard_attempts", 0) > 0: attempts.append(f'üî¥{entry["hard_attempts"]}')
            
            if attempts:
                text += f'   –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–π: {" ".join(attempts)}\n\n'
            else:
                text += '\n'
    
    # –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    nav_buttons = []
    
    # –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" (–µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
    if page > 0:
        nav_buttons.append(InlineKeyboardButton("‚¨ÖÔ∏è", callback_data=f'leaderboard_page_{page-1}'))
        
    # –ö–Ω–æ–ø–∫–∞ "–í–ø–µ—Ä–µ–¥" (–µ—Å–ª–∏ –µ—Å—Ç—å –µ—â–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
    if (page + 1) * 10 < total_users:
        nav_buttons.append(InlineKeyboardButton("‚û°Ô∏è", callback_data=f'leaderboard_page_{page+1}'))
    
    keyboard = []
    if nav_buttons:
        keyboard.append(nav_buttons)
        
    keyboard.append([InlineKeyboardButton("üéØ –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç", callback_data='start_test')])
    keyboard.append([InlineKeyboardButton("‚¨ÖÔ∏è –í –º–µ–Ω—é", callback_data='back_to_main')])
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await query.edit_message_text(text, reply_markup=reply_markup, parse_mode='Markdown')

# –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
async def show_my_stats(query):
    user_id = query.from_user.id
    
    position, entry = get_user_position(user_id)
    
    if not entry:
        text = 'üìä *–ú–û–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê*\n\n'
        text += '–í—ã –µ—â—ë –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —Ç–µ—Å—Ç—ã.\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /test —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å!'
    else:
        text = 'üìä *–ú–û–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê*\n\n'
        text += f'üèÖ –ü–æ–∑–∏—Ü–∏—è –≤ –æ–±—â–µ–º —Ä–µ–π—Ç–∏–Ω–≥–µ: *#{position}*\n'
        text += f'üíé –í—Å–µ–≥–æ –±–∞–ª–ª–æ–≤: *{entry.get("total_points", 0)}*\n\n'
        
        text += 'üìà *–ö–û–õ–ò–ß–ï–°–¢–í–û –ü–†–û–•–û–ñ–î–ï–ù–ò–ô:*\n'
        text += f'üü¢ –õ—ë–≥–∫–∏–π: {entry.get("easy_attempts", 0)} —Ä–∞–∑(–∞)\n'
        text += f'üü° –°—Ä–µ–¥–Ω–∏–π: {entry.get("medium_attempts", 0)} —Ä–∞–∑(–∞)\n'
        text += f'üî¥ –°–ª–æ–∂–Ω—ã–π: {entry.get("hard_attempts", 0)} —Ä–∞–∑(–∞)\n\n'
        
        text += '‚≠ê *–õ–£–ß–®–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´:*\n'
        if entry.get("easy_attempts", 0) > 0:
            text += f'üü¢ –õ—ë–≥–∫–∏–π: {entry.get("easy_best_score")}/10 ‚Ä¢ {format_time(entry.get("easy_best_time"))}\n'
        if entry.get("medium_attempts", 0) > 0:
            text += f'üü° –°—Ä–µ–¥–Ω–∏–π: {entry.get("medium_best_score")}/10 ‚Ä¢ {format_time(entry.get("medium_best_time"))}\n'
        if entry.get("hard_attempts", 0) > 0:
            text += f'üî¥ –°–ª–æ–∂–Ω—ã–π: {entry.get("hard_best_score")}/10 ‚Ä¢ {format_time(entry.get("hard_best_time"))}\n'
        
        text += f'\nüìÖ –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: {entry.get("last_date", "?")}'
    
    # –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    keyboard = [
        [InlineKeyboardButton("üéØ –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç", callback_data='start_test')],
        [InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data='back_to_main')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await query.edit_message_text(text, reply_markup=reply_markup, parse_mode='Markdown')

# –í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
async def back_to_main(update: Update, context):
    query = update.callback_query
    await query.answer()
    
    keyboard = [
        [InlineKeyboardButton("üìñ –û –±–æ—Ç–µ", callback_data='about')],
        [InlineKeyboardButton("üéØ –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç", callback_data='start_test')],
        [InlineKeyboardButton("üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤", callback_data='leaderboard')],
        [InlineKeyboardButton("üìä –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data='my_stats')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await query.edit_message_text(
        'üìñ *–ë–ò–ë–õ–ï–ô–°–ö–ò–ô –¢–ï–°–¢-–ë–û–¢*\n\n'
        '–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:',
        reply_markup=reply_markup,
        parse_mode='Markdown'
    )

# –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
async def choose_level(update, context, is_callback=False):
    keyboard = [
        [InlineKeyboardButton("üü¢ –õ—ë–≥–∫–∏–π (1 –±–∞–ª–ª –∑–∞ –≤–æ–ø—Ä–æ—Å)", callback_data='level_easy')],
        [InlineKeyboardButton("üü° –°—Ä–µ–¥–Ω–∏–π (2 –±–∞–ª–ª–∞ –∑–∞ –≤–æ–ø—Ä–æ—Å)", callback_data='level_medium')],
        [InlineKeyboardButton("üî¥ –°–ª–æ–∂–Ω—ã–π (3 –±–∞–ª–ª–∞ –∑–∞ –≤–æ–ø—Ä–æ—Å)", callback_data='level_hard')],
        [InlineKeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data='back_to_main')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    text = (
        'üéØ *–í–´–ë–ï–†–ò –£–†–û–í–ï–ù–¨ –°–õ–û–ñ–ù–û–°–¢–ò*\n\n'
        'üü¢ *–õ—ë–≥–∫–∏–π:* 1 –±–∞–ª–ª –∑–∞ –≤–æ–ø—Ä–æ—Å\n'
        '–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–∫—Ç—ã, –¥–∞—Ç—ã, –∏–º–µ–Ω–∞\n\n'
        'üü° *–°—Ä–µ–¥–Ω–∏–π:* 2 –±–∞–ª–ª–∞ –∑–∞ –≤–æ–ø—Ä–æ—Å\n'
        '–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç, –∑–Ω–∞—á–µ–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–æ–≤\n\n'
        'üî¥ *–°–ª–æ–∂–Ω—ã–π:* 3 –±–∞–ª–ª–∞ –∑–∞ –≤–æ–ø—Ä–æ—Å\n'
        '–ë–æ–≥–æ—Å–ª–æ–≤—Å–∫–∏–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏, –≥—Ä–µ—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã, –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑'
    )
    
    if is_callback and hasattr(update, 'callback_query'):
        await update.callback_query.edit_message_text(text, reply_markup=reply_markup, parse_mode='Markdown')
    else:
        # –í—ã–∑–≤–∞–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π /test
        await update.message.reply_text(text, reply_markup=reply_markup, parse_mode='Markdown')

# –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
async def level_selected(update: Update, context):
    query = update.callback_query
    await query.answer()
    
    user_id = update.effective_user.id
    
    if query.data == 'back_to_main':
        await back_to_main(update, context)
        # –ï—Å–ª–∏ –Ω–∞–∂–∞–ª–∏ "–ù–∞–∑–∞–¥", –∑–∞–≤–µ—Ä—à–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
        return ConversationHandler.END
    
    # –í—ã–±–æ—Ä –Ω–∞–±–æ—Ä–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
    if query.data == 'level_easy':
        questions = easy_questions
        level_name = "üü¢ –õ—ë–≥–∫–∏–π"
        level_key = "easy"
    elif query.data == 'level_medium':
        questions = medium_questions
        level_name = "üü° –°—Ä–µ–¥–Ω–∏–π"
        level_key = "medium"
    else:  # hard
        questions = hard_questions
        level_name = "üî¥ –°–ª–æ–∂–Ω—ã–π"
        level_key = "hard"
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_data[user_id] = {
        "questions": questions,
        "level_name": level_name,
        "level_key": level_key,
        "current_question": 0,
        "correct_answers": 0,
        "wrong_answers": [],
        "start_time": time.time()
    }
    
    await query.edit_message_text(
        f'*{level_name} —É—Ä–æ–≤–µ–Ω—å*\n\n'
        f'–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç! üìù\n'
        f'–ó–∞—Å–µ–∫–∞–µ–º –≤—Ä–µ–º—è... ‚è±',
        parse_mode='Markdown'
    )
    await send_question(query.message, user_id)
    return ANSWERING

# –û—Ç–ø—Ä–∞–≤–∫–∞ –≤–æ–ø—Ä–æ—Å–∞
async def send_question(message, user_id):
    data = user_data[user_id]
    q_num = data["current_question"]
    
    if q_num >= len(data["questions"]):
        await show_results(message, user_id)
        return ConversationHandler.END
    
    q = data["questions"][q_num]
    keyboard = [[option] for option in q["options"]]
    
    await message.reply_text(
        f'*–í–æ–ø—Ä–æ—Å {q_num + 1}/10*\n\n{q["question"]}\n\n–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:',
        reply_markup=ReplyKeyboardMarkup(keyboard, one_time_keyboard=True, resize_keyboard=True),
        parse_mode='Markdown'
    )

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
async def answer(update: Update, context):
    user_id = update.effective_user.id
    
    if user_id not in user_data:
        await update.message.reply_text("–ò—Å–ø–æ–ª—å–∑—É–π /test —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ç–µ—Å—Ç")
        return ConversationHandler.END
    
    data = user_data[user_id]
    q_num = data["current_question"]
    q = data["questions"][q_num]
    
    user_answer = update.message.text
    
    try:
        answer_index = q["options"].index(user_answer)
        if answer_index == q["correct"]:
            data["correct_answers"] += 1
        else:
            data["wrong_answers"].append({
                "question": q["question"],
                "your_answer": user_answer,
                "correct_answer": q["options"][q["correct"]],
                "explanation": q["explanation"]
            })
        
        await update.message.reply_text("‚úì –ü—Ä–∏–Ω—è—Ç–æ", reply_markup=ReplyKeyboardRemove())
        
    except ValueError:
        await update.message.reply_text("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤")
        return ANSWERING
    
    data["current_question"] += 1
    
    if data["current_question"] < len(data["questions"]):
        await send_question(update.message, user_id)
        return ANSWERING
    else:
        await show_results(update.message, user_id)
        return ConversationHandler.END

# –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
async def show_results(message, user_id):
    data = user_data[user_id]
    score = data["correct_answers"]
    total = len(data["questions"])
    percentage = (score / total) * 100
    
    time_taken = time.time() - data["start_time"]
    user = message.from_user
    
    add_to_leaderboard(
        user_id,
        user.username,
        user.first_name,
        data["level_key"],
        score,
        total,
        time_taken
    )
    
    position, entry = get_user_position(user_id)
    points_per_question = {"easy": 1, "medium": 2, "hard": 3}
    earned_points = score * points_per_question[data["level_key"]]
    
    if percentage >= 90:
        grade = "–û—Ç–ª–∏—á–Ω–æ! üåü"
        emoji = "üèÜ"
    elif percentage >= 70:
        grade = "–•–æ—Ä–æ—à–æ! üëç"
        emoji = "‚úÖ"
    elif percentage >= 50:
        grade = "–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ üìñ"
        emoji = "üìù"
    else:
        grade = "–ù—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª üìö"
        emoji = "üìñ"
    
    result_text = f'{emoji} *–†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ê*\n\n'
    result_text += f'*–£—Ä–æ–≤–µ–Ω—å:* {data["level_name"]}\n'
    result_text += f'*–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:* {score} –∏–∑ {total}\n'
    result_text += f'*–ü—Ä–æ—Ü–µ–Ω—Ç:* {percentage:.0f}%\n'
    result_text += f'*–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –±–∞–ª–ª–æ–≤:* +{earned_points} üíé\n'
    result_text += f'*–í—Å–µ–≥–æ –±–∞–ª–ª–æ–≤:* {entry.get("total_points", 0)} üíé\n'
    result_text += f'*–í—Ä–µ–º—è:* {format_time(time_taken)}\n'
    result_text += f'*–ü–æ–∑–∏—Ü–∏—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ:* #{position}\n'
    result_text += f'*–û—Ü–µ–Ω–∫–∞:* {grade}\n\n'
    
    if data["wrong_answers"]:
        result_text += '‚ùå *–†–ê–ó–ë–û–† –û–®–ò–ë–û–ö:*\n\n'
        for i, wrong in enumerate(data["wrong_answers"], 1):
            result_text += f'*{i}. {wrong["question"]}*\n'
            result_text += f'   ‚ùå –í–∞—à –æ—Ç–≤–µ—Ç: {wrong["your_answer"]}\n'
            result_text += f'   ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: {wrong["correct_answer"]}\n'
            result_text += f'   üìù {wrong["explanation"]}\n\n'
    else:
        result_text += 'üéâ *–í—Å–µ –æ—Ç–≤–µ—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ!*\n\n'
    
    keyboard = [
        [InlineKeyboardButton("üîÑ –ü—Ä–æ–π—Ç–∏ —Å–Ω–æ–≤–∞", callback_data='start_test')],
        [InlineKeyboardButton("üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤", callback_data='leaderboard')],
        [InlineKeyboardButton("‚¨ÖÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await message.reply_text(result_text, reply_markup=reply_markup, parse_mode='Markdown')

# –ö–æ–º–∞–Ω–¥–∞ /test
async def test_command(update: Update, context):
    await choose_level(update, context, is_callback=False)
    return CHOOSING_LEVEL

# –ö–æ–º–∞–Ω–¥–∞ /leaderboard
async def leaderboard_command(update: Update, context):
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    await show_general_leaderboard(update.message, 0)

# –û—Ç–º–µ–Ω–∞
async def cancel(update: Update, context):
    keyboard = [[InlineKeyboardButton("‚¨ÖÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]]
    await update.message.reply_text('‚ùå –¢–µ—Å—Ç –æ—Ç–º–µ–Ω—ë–Ω.', reply_markup=InlineKeyboardMarkup(keyboard))
    return ConversationHandler.END

# –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
def main():
    app = Application.builder().token("8134773553:AAF4DWLR7DBDolkigso_ZgXd4Ml_90YaaK8").build()
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ—Å—Ç–∞
    conv_handler = ConversationHandler(
        entry_points=[
            CommandHandler('test', test_command),
            CallbackQueryHandler(level_selected, pattern='^level_')
        ],
        states={
            CHOOSING_LEVEL: [CallbackQueryHandler(level_selected)],
            ANSWERING: [MessageHandler(filters.TEXT & ~filters.COMMAND, answer)]
        },
        fallbacks=[
            CommandHandler('cancel', cancel),
            CallbackQueryHandler(back_to_main, pattern='^back_to_main$'),
            CallbackQueryHandler(button_handler, pattern='^(about|start_test|leaderboard|my_stats)$'),
            # –î–æ–±–∞–≤–∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü —Å –ª–∏–¥–µ—Ä–∞–º–∏, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–∞ –¥–∞–∂–µ –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∞
            CallbackQueryHandler(button_handler, pattern='^leaderboard_page_')
        ],
        allow_reentry=True
    )
    
    app.add_handler(conv_handler)
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("leaderboard", leaderboard_command))
    
    # –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ: –ª–æ–≤–∏–º –∏ –æ–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏, –∏ –∫–Ω–æ–ø–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü
    app.add_handler(CallbackQueryHandler(button_handler, pattern='^(about|start_test|leaderboard|my_stats|leaderboard_page_\d+)$'))
    app.add_handler(CallbackQueryHandler(back_to_main, pattern='^back_to_main$'))
    
    print('ü§ñ –ë–∏–±–ª–µ–π—Å–∫–∏–π —Ç–µ—Å—Ç-–±–æ—Ç –∑–∞–ø—É—â–µ–Ω!')
    app.run_polling()

if __name__ == '__main__':
    main()
```


